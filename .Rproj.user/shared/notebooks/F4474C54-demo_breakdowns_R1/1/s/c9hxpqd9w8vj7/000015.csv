"0","generate_dup_plots <- function(df, country, survey_question, round_of_surveying) {"
"0","  # Create folder if it doesn't exist"
"0"," folder_path <- paste0(here(""response_analysis"",""response_visuals""))"
"0","  if (!file.exists(folder_path)) {"
"0","    dir.create(folder_path)"
"0","    print(paste(""Folder"", folder_path, ""created.""))"
"0","  }"
"0","  "
"0","  # Save survey question as a title for plotting"
"0","  if (survey_question %in% names(df)) {"
"0","    # Modify survey question title"
"0","    survey_question_title <- tools::toTitleCase(survey_question)"
"0","    survey_question_title <- gsub(""_"", "" "", survey_question_title)"
"0","    "
"0","    # Group by IP address and comp_phone1_try1"
"0","    grouped_df <- df %>%"
"0","      group_by(ip_address, comp_phone1_try1) %>%"
"0","      summarise()"
"0","    "
"0","    # Iterate over each group and generate individual histograms"
"0","    for (i in 1:nrow(grouped_df)) {"
"0","      ip <- grouped_df$ip_address[i]"
"0","      phone <- grouped_df$comp_phone1_try1[i]"
"0","      "
"0","      # Subset data for the current group"
"0","      plot_data <- df %>%"
"0","        filter(ip_address == ip, comp_phone1_try1 == phone) %>%"
"0","        # label groups by age demo"
"0","        mutate(age_group = fct_reorder(age_group, .data[[survey_question]])) %>%"
"0","        mutate(age_group = factor(age_group, levels=c(""18-29"", ""30-49"", ""50+"", NA))) %>%"
"0","        # count frequency "
"0","        group_by(age_group, gender, .data[[survey_question]]) %>%"
"0","        summarise(count = n()) %>%"
"0","        ungroup() %>% "
"0","        # create histogram"
"0","        ggplot(aes(fill = gender, y = .data[[survey_question]], x= age_group)) + "
"0","        geom_col(position=""dodge"", alpha=0.5, outlier.colour=""transparent"") +"
"0","        labs(title = paste0(country, "" "", survey_question_title, "" Distribution in Age Demographics""),"
"0","             subtitle = paste0(""Adaptation Observatory Survey Responses: "", round_of_surveying),"
"0","             x = ""Age Demographic Groups"","
"0","             y = paste0(""Count of "", survey_question_title, "" (IP:"", ip, "", Phone:"", phone, "")"")) +"
"0","        # count of language frequency "
"0","        geom_text(aes(label = count,"
"0","                      fontface = ""bold""),"
"0","                  size = 3,"
"0","                  position = position_dodge(width = 0.9),"
"0","                  hjust = .5,"
"0","                  vjust = -0.4,"
"0","                  color = ""grey40"") +"
"0","        # customs"
"0","        scale_fill_manual(values = colors) +"
"0","        theme_classic()  +"
"0","        theme("
"0","          plot.title = element_text(size = 15,"
"0","                                    hjust = .5),"
"0","          plot.subtitle = element_text(size = 12,"
"0","                                       hjust = .5),"
"0","          axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0)) # Adjust y-axis title position"
"0","        ) "
"0","      "
"0","      # Save plot as a png"
"0","      plot_filename <- paste0(folder_path, ""/"", country, ""/"", round_of_surveying, ""/"", ""dup_data_vis"" ,""/"", country, ""_"", survey_question, ""_response_analysis_"", round_of_surveying, "".png"")"
"0","      ggsave(filename = plot_filename, plot = plot_data, width = 8, height = 5, dpi = 300)"
"0","      "
"0","      print(paste(""Plot for IP:"", ip, ""and Phone:"", phone, ""saved successfully.""))"
"0","    }"
"0","  } else {"
"0","    print(""Specified survey question column does not exist in the dataframe."")"
"0","  }"
"0","}"
